% Copyright 2022 Douglas Myers-Turnbull
% This work may be distributed and/or modified under the conditions of the LaTeX Project Public
% License, either version 1.3 of this license or (at your option) any later version. The latest
% version of this license is in http://www.latex-project.org/lppl.txt and version 1.3 or later is
% part of all distributions of LaTeX version 2005/12/01 or later.
%==================================================================================================


%=======                                                   =======
%=======                 Semantic Links                    =======
%=======                                                   =======

\NeedsTeXFormat {LaTeX2e} [2020-10-01]
\ExplSyntaxOn
\ProvidesExplPackage {semantic} {2022-02-28} {0.1.1} { Semantic~links~and~other~things }
\RequirePackage {hyperxmp}
\RequirePackage {academicons}



%==================================================================================================
%                        text
%==================================================================================================

% mostly stolen from package "semantic-markup"
% I would load it, but it contains too many extra features and dependencies

% These are all standard; \foreign is the only debatable one.

\NewExpandableDocumentCommand \foreign { m }
    { \textit{#1} }  % e.g. "et al." or "in vivo"

\NewExpandableDocumentCommand \code { m }
    { \texttt{#1} }

\NewExpandableDocumentCommand \term { m }
    { \textit{#1} }

\NewExpandableDocumentCommand \mentioned { m }
    { \textit{#1} }

\NewExpandableDocumentCommand \worktitle { m }
    { \textit{#1} }

\NewExpandableDocumentCommand \parttitle { m }
    { ``#1" }

% use \textelp, \textelp*, \textins, and \textins* from csquotes instead

%\NewExpandableDocumentCommand \quoteaddition { m }
%    { [#1] }

%\NewExpandableDocumentCommand \quoteomission { }
%    { [\ldots] }


\NewDocumentCommand \brokensequence { m }
{
    \group_begin:
    \ttfamily
    \seq_set_split:Nnn \l_tmpa_seq {\space} { #1 }
    \seq_use:Nn \l_tmpa_seq { \linebreak[0] }
    \group_end:
}


%==================================================================================================
%                    math
%==================================================================================================

% punctuation at the end of an equation, normally either a comma or period
\NewExpandableDocumentCommand \punc { m }
    { \,\text{#1} }

% Math commands with proper amsmath format
\NewExpandableDocumentCommand \angled { m }
    { \left\langle #1 \right\rangle }

\NewExpandableDocumentCommand \abs { m }
    { \left\lvert #1 \right\rvert }

\NewExpandableDocumentCommand \norm { m }
    { \left\lVert #1 \right\rVert }

\NewExpandableDocumentCommand \floor { m }
    { \left\lfloor #1 \right\rfloor }

\NewExpandableDocumentCommand \ceil { m }
    { \left\lceil #1 \right\rceil }


%==================================================================================================
%                    links
%==================================================================================================


%\begingroup\lccode`?=`# \lowercase{\endgroup
%    \newcommand{\myhrefaux}[2]{\href{#1}{#2}}
%}

%\DeclareRobustCommand*{\myurl}{\hyper@normalise\myurl@}

%\def\@myurl@#1{\hyper@linkurl{#2}{#1}}

\tl_const:Nx \c_https_tl {https \c_colon_str //}

\cs_new_protected:Npn \semantic_link:nnn #1#2#3
{
    \tl_if_blank:nTF {#2}
    {
        #3  % if the url (#2) is empty, don't make a link
    }
    {
        \group_begin:
        \bool_if:nT {#1}
            { \hypersetup{hidelinks=true} }
        \tl_if_blank:nTF {#3}
            { \href {#2} {#2} }
            { \href {#2} {#3} }
        \group_end:
    }
}

\NewDocumentCommand \link { s >{\TrimSpaces}m O{} }
{
    \semantic_link:nnn{#1}{#2}{#3}
}


\NewDocumentCommand \doi { s >{\TrimSpaces}m }
    { \semantic_link:nnn {#1} {https\c_colon_str//doi.org/#2} {\textsc{doi}:#2} }
\NewDocumentCommand \doix { s >{\TrimSpaces}m }
    { \semantic_link:nnn {#1} {https\c_colon_str//doi.org/#2} {\aiDoi\thinspace#2} }

\NewDocumentCommand \arXiv { s >{\TrimSpaces}m }
    { \semantic_link:nnn {#1} {https\c_colon_str//arxiv.org/abs/#2} {ar\textsc{x}iv:#2} }
\NewDocumentCommand \arxivx { s >{\TrimSpaces}m }
    { \semantic_link:nnn {#1} {https\c_colon_str//arxiv.org/abs/#2} {\aiarXiv\thinspace#2} }

\NewDocumentCommand \bioarxiv { s >{\TrimSpaces}m }
    {semantics_link:nnn {#1} {https\c_colon_str//www.biorxiv.org/content/#2} {bio\textsc{r}xiv:#2} }
\NewDocumentCommand \bioarxivx { s >{\TrimSpaces}m }
    { \semantic_link:nnn {#1} {https\c_colon_str//www.biorxiv.org/content/#2} {\aibioRxiv\thinspace#2} }

\NewDocumentCommand \orcid { s >{\TrimSpaces}m }
    { \semantic_link:nnn {#1} {https\c_colon_str//orcid.org/#2} {https\c_colon_str//orcid.org/#2} }  % they recommend full URL
\NewDocumentCommand \orcidx { s >{\TrimSpaces}m }
    { \semantic_link:nnn {#1} {https\c_colon_str//orcid.org/#2} {\aiOrcid\thinspace#2} }

\NewDocumentCommand \dblp { s >{\TrimSpaces}m }
    { \semantic_link:nnn {#1} {https\c_colon_str//dblp.org/pid/#2} {dblp:#2} }  % it's lowercase
\NewDocumentCommand \dblpx { s >{\TrimSpaces}m }
    { \semantic_link:nnn {#1} {https\c_colon_str//dblp.org/pid/#2} {\aidblp\thinspace#2} }

\NewDocumentCommand \rrid { s >{\TrimSpaces}m }
    { \semantic_link:nnn {#1} {https\c_colon_str//scicrunch.org/resolver/#2} {\textsc{rrid}:#2} }
\NewDocumentCommand \rridx { s m }
    { \semantic_link:nnn {#1} {https\c_colon_str//scicrunch.org/resolver/#2} {\textsc{rrid}:#2} }

\NewDocumentCommand \semanticscholar { s >{\TrimSpaces}m } % e.g. 1403902308
    { \semantic_link:nnn {#1} {https\c_colon_str//semanticscholar.org/author/#2} {Semantic Scholar:#2} }
\NewDocumentCommand \semanticscholarx { s >{\TrimSpaces}m }
    { \semantic_link:nnn {#1} {https\c_colon_str//semanticscholar.org/author/#2} {\aiSemanticScholar\thinspace#2} }

\NewDocumentCommand \ieeeauthor { s >{\TrimSpaces}m }
    { \semantic_link:nnn {#1} {https\c_colon_str//ieeexplore.ieee.org/author/#2} {\textsc{ieee}:#2} }
\NewDocumentCommand \ieeeauthorx { s >{\TrimSpaces}m }
    { \semantic_link:nnn {#1} {https\c_colon_str//ieeexplore.ieee.org/author/#2} {\aiIEEE\thinspace#2} }

\NewDocumentCommand \ctan { s m }
    { \semantic_link:nnn {#1} {https\c_colon_str//ctan.org/pkg/#2} {#2} }
\NewDocumentCommand \ctanx { s >{\TrimSpaces}m }
    { \semantic_link:nnn {#1} {https\c_colon_str//ctan.org/pkg/#2} {\textsc{ctan}:#2} }
