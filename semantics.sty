% Copyright 2022 Douglas Myers-Turnbull
% This work may be distributed and/or modified under the conditions of the LaTeX Project Public
% License, either version 1.3 of this license or (at your option) any later version. The latest
% version of this license is in http://www.latex-project.org/lppl.txt and version 1.3 or later is
% part of all distributions of LaTeX version 2005/12/01 or later.
%==================================================================================================


%=======                                                   =======
%=======                 Semantic Links                    =======
%=======                                                   =======

\NeedsTeXFormat{LaTeX2e}[2020-10-01]
\ExplSyntaxOn
\ProvidesExplPackage{semantics} {2022-02-10} {0.1} {Semantic~links~and~other~things}
\RequirePackage{hyperxmp}
\RequirePackage{academicons}



%==================================================================================================
%                        text
%==================================================================================================

% mostly stolen from package "semantic-markup"
% I would load it, but it contains too many extra features and dependencies

% These are all standard; \foreign is the only debatable one.

\NewDocumentCommand \foreign { m }
    { \textit{#1} }  % e.g. "et al." or "in vivo"

\NewDocumentCommand \code { m }
    { \textit{#1} }

\NewDocumentCommand \term { m }
    { \textit{#1} }

\NewDocumentCommand \mentioned { m }
    { \textit{#1} }

\NewDocumentCommand \worktitle { m }
    { \textit{#1} }

\NewDocumentCommand \parttitle { m }
    { \textquote{#1} }

\NewDocumentCommand \quoteaddition { m }
    { [#1] }

\NewDocumentCommand \quoteomission { }
    { [\ldots] }

\NewDocumentCommand \breaksequence { m }
{
    \group_begin:
    \ttfamily
    \seq_set_split:Nnn \l_tmpa_seq {\space} { #1 }
    \seq_use:Nn \l_tmpa_seq { \linebreak[0] }
    \group_end:
}


%==================================================================================================
%                    math
%==================================================================================================

% punctuation at the end of an equation, normall either a comma or period
\DeclareDocumentCommand \punc { m } { \,\text{#1} }

% Math commands with proper amsmath format
\NewDocumentCommand \angled { m }
    { \left\langle #1 \right\rangle }

\NewDocumentCommand \abs { m }
    { \left\lvert #1 \right\rvert }

\NewDocumentCommand \norm { m }
    { \left\lVert #1 \right\rVert }

\NewDocumentCommand \floor { m }
    { \left\lfloor #1 \right\rfloor }

\NewDocumentCommand \ceil { m }
    { \left\lceil #1 \right\rceil }


%==================================================================================================
%                    links
%==================================================================================================

\cs_new:Npn \semantics_link:nnn #1#2#3
{
    \tl_if_blank:nTF {#2}
    {
        #2  % if the url (#3) is empty, don't make a link
    }
    {
        \bool_if:nT {#1}
        {
            \group_begin:
            \hypersetup{hidelinks} #1
        }
        \bool_if_blank:nTF {#3}
            { \href{#2}{#2} }   % no text provided -- use the url itself
            { \href{#2}{#3} }   % text provided
        \bool_if:nT {#1} {\group_end:}
    }
}

\ProvideDocumentCommand \link { s >{\TrimSpaces}m o }
{
    \semantics_link:nnn{#1}{#2}{#3}
}


\ProvideDocumentCommand \doi { s >{\TrimSpaces}m }
    { \semantics_link:nnn {#1} {https://doi.org/#1} {\textsc{doi}:#1} }
\ProvideDocumentCommand \doix { s >{\TrimSpaces}m }
    { \semantics_link:nnn {#1} {https://doi.org/#1} {\aiDoi\thinspace#1} }

\ProvideDocumentCommand \arXiv { s >{\TrimSpaces}m }
    { \semantics_link:nnn {#1} {https://arxiv.org/abs/#1} {arXiv:#1} }
\ProvideDocumentCommand \arxivx { s >{\TrimSpaces}m }
    { \semantics_link:nnn {#1} {https://arxiv.org/abs/#1} {\aiarXiv\thinspace#1} }

\ProvideDocumentCommand \bioarxiv { s >{\TrimSpaces}m }
    {semantics_link:nnn {#1} {https://www.biorxiv.org/content/#1} {bioRxiv:#1} }
\ProvideDocumentCommand \bioarxivx { s >{\TrimSpaces}m }
    { \semantics_link:nnn {#1} {https://www.biorxiv.org/content/#1} {\aibioRxiv\thinspace#1} }

\ProvideDocumentCommand \orcid { s >{\TrimSpaces}m }
    { \semantics_link:nnn {#1} {https://orcid.org/#1} }
\ProvideDocumentCommand \orcidx { s >{\TrimSpaces}m }
    { \semantics_link:nnn {#1} {https://orcid.org/#1} {\aiOrcid\thinspace#1} }

\ProvideDocumentCommand \dblp { s >{\TrimSpaces}m }
    { \semantics_link:nnn {#1} {https://dblp.org/pid/#1} }
\ProvideDocumentCommand \dblpx { s >{\TrimSpaces}m }
    { \semantics_link:nnn {#1} {https://dblp.org/pid/#1} {\aidblp\thinspace#1} }

\ProvideDocumentCommand \rrid { s >{\TrimSpaces}m }
    { \semantics_link:nnn {#1} {https://scicrunch.org/resolver/#1} {\textsc{rrid}:#1} }
\ProvideDocumentCommand \rridx { s m }
    { \rrid{#1} }

\ProvideDocumentCommand \semanticscholar { s >{\TrimSpaces}m } % e.g. 1403902308
    { \semantics_link:nnn {#1} {https://semanticscholar.org/author/#1} }
\ProvideDocumentCommand \semanticscholarx { s >{\TrimSpaces}m }
    { \semantics_link:nnn {#1} {https://semanticscholar.org/author/#1} {\aiSemanticScholar\thinspace#1} }

\ProvideDocumentCommand \ieeeauthor { s >{\TrimSpaces}m }
    { \semantics_link:nnn {#1} {https://ieeexplore.ieee.org/author/#1} }
\ProvideDocumentCommand \ieeeauthorx { s >{\TrimSpaces}m }
    { \semantics_link:nnn {#1} {https://ieeexplore.ieee.org/author/#1} {\aiIEEE\thinspace#1} }
